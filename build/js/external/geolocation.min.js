!function(e,o){"function"==typeof define?define(function(){return o(e,e.jQuery||e.Zepto)}):e.geolocation=o(e,e.jQuery||e.Zepto)}(this,function(e,o){var t={options:{ipUrl:"http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js",positionUrl:"http://api.map.baidu.com/geocoder/v2/?ak=8827ee39511568ac0705d037d67b2624&callback=renderReverse&output=json&pois=1",expires:1728e5,cookieName:"geo",enableHighAcuracy:!1,timeout:4e3,geoWaitTime:5e3,maximumAge:1728e5},log:function(){console&&console.log&&console.log.apply(e.console,arguments)},format:function(e){var o;return e&&(o={},o.country=e.country,o.province=e.province,o.city=e.city),o},removeStoredAddress:function(){var e=this,t=e.options;return o.cookie(t.cookieName,null,{expires:-1}),e},storeAddress:function(e){var t=this,r=t.options;return e=e&&JSON.stringify(e),e&&o.cookie(r.cookieName,e,{expires:r.expires/1e3}),t},getStoredAddress:function(){var e=this,t=e.options,r=o.cookie(t.cookieName);return r=r&&JSON.parse(r)},getCurrentPosition:function(e,t,r){var i,n,s=this,a=s.options;if(e&&(!e||"function"===o.type(e)))return t&&"object"==typeof t?i=t:(n=t,i=r),i=o.extend({enableHighAcuracy:a.enableHighAcuracy,timeout:a.timeout,maximumAge:a.maximumAge},i||{}),n=n||function(e){switch(e.code){case e.TIMEOUT:s.log("A timeout occured! Please try again!");break;case e.POSITION_UNAVAILABLE:s.log("We can't detect your location. Sorry!");break;case e.PERMISSION_DENIED:s.log("Please allow geolocation access for this to work.");break;case e.UNKNOWN_ERROR:s.log("An unknown error occured!")}},navigator.geolocation?navigator.geolocation.getCurrentPosition(e,n,i):(s.log("Your browser does not support Geolocation!"),n&&n()),s},getAddress:function(e,o){{var t,r=this;r.options}return(t=r.getStoredAddress())?(e&&e(t),r):(r.getAddressByPosition(e,function(){r.getAddressByIp(e,o)}),r)},getAddressByPosition:function(e,t){var r,i,n,s=this,a=s.options;return(r=s.getStoredAddress())?(e&&e(r),s):(i=a.geoWaitTime&&setTimeout(function(){n=!0,t&&t()},a.geoWaitTime),s.getCurrentPosition(function(c){if(!n){i&&clearTimeout(i);var u=c.coords,d=u.latitude+","+u.longitude;a.positionUrl&&o.ajax({url:a.positionUrl,type:"get",data:{location:d},dataType:"jsonp",jsonpCallback:"renderReverse",success:function(o){o&&o.result&&o.result.addressComponent?(s.storeAddress(r=s.format(o.result.addressComponent)),e&&e(r)):t&&t()},error:t})||t&&t()}},function(e){n||(i&&clearTimeout(i),t&&t(e),t=null)}),s)},getAddressByIp:function(t,r){var i,n=this,s=n.options,a=function(){i=e.remote_ip_info&&n.format(e.remote_ip_info),i?(i&&n.storeAddress(i),t&&t(i)):r&&r()};return(i=n.getStoredAddress())?(t&&t(i),n):(s.ipUrl&&o.ajax({url:s.ipUrl,type:"get",dataType:"jsonp",success:a,error:a})||a(),n)}};return t});